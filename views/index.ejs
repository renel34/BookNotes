<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Reading Journal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Tangerine:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles/main.css" />
  </head>
  <body class="bg-image">
    <div class="container">
      <%- include('header.ejs') %>
      <script>
        document
          .getElementById("sortByRating")
          .addEventListener("click", function () {
            window.location.href = "/rating";
          });

        document
          .getElementById("sortByRecency")
          .addEventListener("click", function () {
            window.location.href = "/recency";
          });

        document
          .getElementById("addABook")
          .addEventListener("click", function () {
            window.location.href = "/add";
          });
      </script>
      <!-- Books Collection -->
      <div class="books-collection card-container">
        <% if (books.length === 0) { %>
        <div class="no-books-message">
          <p>Please add a book.</p>
        </div>
        <% } else { %> <% books.forEach(book => { %>
        <div class="book-card">
          <div class="book-card-content">
            <!-- Book Cover -->
            <div class="book-cover">
              <% if (book.cover_i) { %>
              <img
                src="https://covers.openlibrary.org/b/id/<%= book.cover_i %>-M.jpg"
                alt="<%= book.title %> cover"
                onerror="this.onerror=null; this.src='https://via.placeholder.com/200x300?text=No+Cover+Available';"
              />
              <% } else { %>
              <div
                class="fallback-cover"
                style="background: linear-gradient(to bottom, #2563eb, #1e40af)"
              >
                <div class="text-white text-center p-4">
                  <div class="text-lg font-bold mb-2">
                    <%= book.title.toUpperCase() %>
                  </div>
                  <div class="text-xs mt-2 opacity-80"><%= book.author %></div>
                </div>
              </div>
              <% } %>
            </div>

            <!-- Book Details -->
            <div class="book-details">
              <h2>
                <%= book.title %>
                <span style="font-size: 0.7em"> - by <%= book.author %></span>
              </h2>

              <p><%= book.summary %></p>
              <div class="book-meta">
                <div class="book-date">
                  <span class="font-medium">Read:</span> <%= new
                  Date(book.date_read).toLocaleDateString('en-US', { year:
                  'numeric', month: 'long' }) %>
                </div>
                <div class="rating-actions">
                  <div class="rating">
                    <span class="font-medium">My Rating:</span>
                    <span class="stars">
                      <% for(let i = 1; i <= 5; i++) { %>
                      <span
                        class="star <%= i <= book.rating ? 'star-rating' : 'empty-star' %>"
                        >â˜…</span
                      >
                      <% } %>
                    </span>
                  </div>

                  <div class="book-actions">
                    <form action="/edit" method="get" class="inline-form">
                      <input
                        type="hidden"
                        name="bookId"
                        value="<%= book.id %>"
                      />
                      <button type="submit" class="edit-btn">Edit</button>
                    </form>
                    <form action="/delete" method="post" class="inline-form">
                      <input
                        type="hidden"
                        name="bookId"
                        value="<%= book.id %>"
                      />
                      <button type="submit" class="delete-btn">Delete</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <% }); %> <% } %>
      </div>
      <%- include('footer.ejs') %>
    </div>
  </body>
</html>
